---
# Add migrated_from for instance_groups
- type: replace
  path: /instance_groups/name=consul/migrated_from?
  value:
    - {name: consul_z1, az: z1}
    - {name: consul_z2, az: z2}

- type: replace
  path: /instance_groups/name=nats/migrated_from?
  value:
    - {name: nats_z1, az: z1}
    - {name: nats_z2, az: z2}

- type: replace
  path: /instance_groups/name=etcd/migrated_from?
  value:
    - {name: etcd_z1, az: z1}

- type: replace
  path: /instance_groups/name=uaa/migrated_from?
  value:
    - {name: uaa_z1, az: z1}
    - {name: uaa_z2, az: z2}

- type: replace
  path: /instance_groups/name=api/migrated_from?
  value:
    - {name: api_z1, az: z1}
    - {name: api_z2, az: z2}

- type: replace
  path: /instance_groups/name=cc-clock/migrated_from?
  value:
    - {name: clock_z1, az: z1}

- type: replace
  path: /instance_groups/name=cc-worker/migrated_from?
  value:
    - {name: api_worker_z1, az: z1}
    - {name: api_worker_z2, az: z2}

- type: replace
  path: /instance_groups/name=doppler/migrated_from?
  value:
    - {name: doppler_z1, az: z1}
    - {name: doppler_z2, az: z2}

- type: replace
  path: /instance_groups/name=log-api/migrated_from?
  value:
    - {name: loggregator_trafficcontroller_z1, az: z1}
    - {name: loggregator_trafficcontroller_z2, az: z2}

- type: replace
  path: /instance_groups/name=router/migrated_from?
  value:
    - {name: router_z1, az: z1}
    - {name: router_z2, az: z2}

# Parameterize the diego bbs encryption key label
# and set the label of the key we've extracted to the active label
- type: replace
  path: /instance_groups/name=diego-bbs/jobs/name=bbs/properties/diego/bbs/active_key_label
  value: "((diego_bbs_active_key_label))"
- type: replace
  path: /instance_groups/name=diego-bbs/jobs/name=bbs/properties/diego/bbs/encryption_keys/0/label
  value: "((diego_bbs_active_key_label))"

# Remove routing API, as it's not present in the source deployment
# and this causes problems
- type: remove
  path: /instance_groups/name=api/jobs/name=routing-api

- type: remove
  path: /instance_groups/name=api/jobs/name=consul_agent/properties/consul/agent/services/routing-api

- type: remove
  path: /instance_groups/name=uaa/jobs/name=uaa/properties/uaa/clients/routing_api_client

- type: remove
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/routing_api

- type: remove
  path: /instance_groups/name=cc-worker/jobs/name=cloud_controller_worker/properties/routing_api

- type: remove
  path: /instance_groups/name=router/jobs/name=gorouter/properties/routing_api

- type: remove
  path: /variables/name=routing_api_database_password

- type: remove
  path: /variables/name=uaa_clients_routing_api_client_secret
